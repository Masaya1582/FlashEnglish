name: Distribute to Firebase

on:
  push:
    branches:
      - develop

jobs:
  build:
    runs-on: macos-latest

    steps:
    # リポジトリのチェックアウト
    - name: Checkout code
      uses: actions/checkout@v3

    # Rubyのインストール
    - name: Set up Ruby
      uses: ruby/setup-ruby@v1
      with:
        ruby-version: 3.0

    # CocoaPodsのセットアップ
    - name: Install dependencies
      run: |
        gem install bundler
        gem install cocoapods --pre
        bundle install
        bundle exec pod install

    # Fastlaneの実行
    - name: Run Fastlane
      run: bundle exec fastlane beta
      env:
        FIREBASE_APP_ID: ${{ secrets.FIREBASE_APP_ID }}
        FIREBASE_TOKEN: ${{ secrets.FIREBASE_APP_DISTRIBUTION_API_TOKEN }}
        MATCH_PASSWORD: ${{ secrets.MATCH_PASSWORD }}
        FASTLANE_USER: ${{ secrets.FASTLANE_USER }}
        FASTLANE_PASSWORD: ${{ secrets.FASTLANE_PASSWORD }}
