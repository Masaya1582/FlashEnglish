default_platform(:ios)

platform :ios do
  desc "Push to Firebase App Distribution"
  lane :distribute_to_firebase do
    # 証明書の管理（match を使用している場合）
    match(type: "adhoc", readonly: true, git_url: "https://github.com/Masaya1582/ios-certificates")

    # ビルド
    build_app(
      scheme: "FlashEnglish", # アプリのスキームを指定
      export_method: "ad-hoc"  # ad-hoc 配布
    )

    # Firebase App Distribution へのアップロード
    firebase_app_distribution(
      app: ENV['FIREBASE_APP_ID'], # 環境変数からFirebase App IDを取得
      ipa_path: lane_context[SharedValues::IPA_OUTPUT_PATH], # IPAファイルのパス
      firebase_cli_token: ENV['FIREBASE_APP_DISTRIBUTION_API_TOKEN'], # Firebase CLI トークン
      groups: "all" # テスターグループを指定
    )
  end
end