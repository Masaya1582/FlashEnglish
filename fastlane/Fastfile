default_platform(:ios)

platform :ios do
  desc "Upload to Firebase"
  lane :distribute do
    match(
    type: "adhoc", 
    readonly: true
   )

    increment_build_number

    version_number = get_info_plist_value(path: "./FlashEnglish/Resources/Info.plist", key: "CFBundleShortVersionString")
    build_number = get_build_number

    gym(
      scheme: "FlashEnglish",
      verbose: true
    )
    
    firebase_app_distribution(
      app: ENV["FIREBASE_APP_ID"],
      release_notes: "Beta Release: #{version_number} (Build: #{build_number})",
      firebase_cli_token: ENV["FIREBASE_APP_DISTRIBUTION_API_TOKEN"],
      ENV["FIREBASE_TESTERS"],
      notify_testers: true
    )
  end
end

