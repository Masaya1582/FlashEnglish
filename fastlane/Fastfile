fastlane_version "2.224.0"

default_platform(:ios)

platform :ios do
  # Ensure the Firebase plugin is installed
  before_all do
    # Install Firebase plugin if not already installed
    unless File.exist?('Gemfile') && File.read('Gemfile').include?('fastlane-plugin-firebase_app_distribution')
      puts "Adding fastlane-plugin-firebase_app_distribution to the Gemfile"
      sh "fastlane add_plugin firebase_app_distribution"
    end
  end

  # Define the beta lane
  desc "Distribute the app to Firebase App Distribution"
  lane :beta do
    # Ensure build configuration and IPA generation
    build_app(scheme: "FlashEnglish")

    # Upload to Firebase App Distribution
    firebase_app_distribution(
      app: ENV["FIREBASE_APP_ID"],
      ipa_path: lane_context[SharedValues::IPA_OUTPUT_PATH],
      firebase_cli_token: ENV["FIREBASE_APP_DISTRIBUTION_API_TOKEN"],  # Firebase token stored in environment variables
      groups: "testers",  # Specify the group of testers if needed
      release_notes: "Beta release"  # Add optional release notes
    )
  end
end

